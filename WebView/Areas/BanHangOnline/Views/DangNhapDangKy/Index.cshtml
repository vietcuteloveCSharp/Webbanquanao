@{
    ViewData["Title"] = "Đăng nhập - Đăng ký";
}
<style>
    #toast-container {
        right: 0;
    }
</style>
   
<div class="toast-container" id="toast-container"></div>
<div class="container mt-5">
    <div class="row">
        <!-- Đăng nhập -->
        <div class="col-md-6 border-end">
            <h3 class="mb-4">Đăng nhập</h3>
            <form id="loginForm" action="/BanHangOnline/DangNhapdangky/DangNhap" method="post" novalidate>
                <div class="mb-3">
                    <label for="taikhoanDN" class="form-label">Tài khoản <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="taikhoanDN" name="TaikhoanDN"
                           placeholder="Nhập tài khoản của bạn" required>
                    <div class="invalid-feedback">Vui lòng nhập tài khoản hợp lệ.</div>
                </div>
                <div class="mb-3">
                    <label for="loginPasswordDN" class="form-label">
                        Mật khẩu <span class="text-danger">*</span>
                    </label>
                    <div class="input-group">
                        <input type="password" class="form-control" name="PasswordDN" id="loginPasswordDN"
                               placeholder="Nhập mật khẩu" required>
                        <button type="button" class="btn btn-outline-secondary"
                                onclick="togglePassword('loginPasswordDN')">
                            <i class="fa-regular fa-eye-slash"></i>
                        </button>
                        <div class="invalid-feedback">Vui lòng nhập mật khẩu.</div>
                    </div>
                </div>
                <div class="d-flex justify-content-between align-items-center mb-4">
                    @* <div>
                        <input type="checkbox" name="rememberMe" id="rememberMe">
                        <label for="rememberMe">Giữ trạng thái đăng nhập</label>
                    </div> *@
                    @* <a href="#" data-bs-toggle="modal" data-bs-target="#forgotPasswordModal">Quên mật khẩu?</a> *@
                </div>
                <button type="submit" class="btn btn-danger w-100">Đăng nhập</button>
            </form>
        </div>

        <!-- Đăng ký -->
        <div class="col-md-6">
            <h3 class="mb-4">Đăng ký</h3>
            <form id="registerForm" action="/BanHangOnline/DangNhapdangky/DangKy" method="post" novalidate>
                <div class="mb-3">
                    <label for="taikhoanDK" class="form-label">Tài khoản <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="taikhoanDK" name="TaikhoanDK"
                           placeholder="Nhập tài khoản đăng ký của bạn" required>
                    <div class="invalid-feedback">Vui lòng nhập tài khoản.</div>
                </div>
                <div class=" mb-3">
                    <label for="nameFull" class="form-label">Họ và tên <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="nameFull" name="NameFullDK"
                           placeholder="Nhập họ và tên của bạn" required>
                    <div class="invalid-feedback">Vui lòng nhập họ và tên.</div>
                </div>
                <div class="mb-3">
                    <label for="registerPhone" class="form-label">SĐT <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" name="RegisterPhoneDK" id="registerPhone"
                           placeholder="Nhập số điện thoại" required>
                    <div class="invalid-feedback">Vui lòng nhập số điện thoại hợp lệ.</div>
                </div>
                <div class="mb-3">
                    <label for="emailDK" class="form-label">Email <span class="text-danger">*</span></label>
                    <input type="email" class="form-control" id="emailDK" name="EmailDK"
                           placeholder="Nhập email của bạn" required>
                    <div class="invalid-feedback">Vui lòng nhập email hợp lệ.</div>
                </div>
                <div class="mb-3">
                    <label for="dob" class="form-label">Ngày sinh</label>
                    <input type="date" class="form-control" name="NgaySinhDK" id="dob" required>
                    <div class="invalid-feedback">Vui lòng nhập ngày sinh.</div>
                </div>
                <div class="mb-3">
                    <label for="registerPassword" class="form-label">
                        Mật khẩu <span class="text-danger">*</span>
                    </label>
                    <input type="password" class="form-control" name="RegisterPasswordDK" id="registerPassword"
                           placeholder="Nhập mật khẩu" required>
                    <div class="invalid-feedback">Vui lòng nhập mật khẩu.</div>
                </div>
                <div class="mb-3">
                    <label for="confirmPassword" class="form-label">
                        Xác nhận mật khẩu <span class="text-danger">*</span>
                    </label>
                    <input type="password" class="form-control" id="confirmPassword" name="ConfirmPasswordDK"
                           placeholder="Nhập lại mật khẩu xác nhận" required>
                    <div class="invalid-feedback">Mật khẩu xác nhận không khớp.</div>
                </div>
                <button type="submit" class="btn btn-danger w-100">Đăng ký</button>
            </form>
        </div>
    </div>
</div>

<!-- Modal Quên Mật Khẩu -->
<div class="modal fade" id="forgotPasswordModal" tabindex="-1" aria-labelledby="forgotPasswordLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form action="/lay-lai-mk" method="post" novalidate>
                <div class="modal-header">
                    <h5 class="modal-title" id="forgotPasswordLabel">Quên mật khẩu?</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Vui lòng nhập email của Quý Khách để đặt lại mật khẩu.</p>
                    <div class="mb-3">
                        <label for="emailDK" class="form-label">Email <span class="text-danger">*</span></label>
                        <input type="email" class="form-control" id="emailDK" name="emailDK"
                               placeholder="Nhập email của bạn" required>
                        <div class="invalid-feedback">Vui lòng nhập email hợp lệ.</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-danger">Gửi</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // Toggle mật khẩu
    function togglePassword(id) {
        const input = document.getElementById(id);
        if (input.type === 'password') {
            input.type = 'text';
        } else {
            input.type = 'password';
        }
    }
    // Validation cho form
    (function () {
        'use strict';

        const registerForm = document.querySelector('#registerForm');
        
        registerForm.addEventListener('submit', event => {
                // Lấy các trường mật khẩu
                const password = document.getElementById('registerPassword');
                const confirmPassword = document.getElementById('confirmPassword');
                const taikhoanDK = document.getElementById('taikhoanDK');
                const registerPhone = document.getElementById('registerPhone');
                const nameFull = document.getElementById('nameFull');
                const emailDK = document.getElementById('emailDK');
                const dob = document.getElementById('dob');

                let isValid = true;
                // Biểu thức chính quy để kiểm tra định dạng email
                const emailPattern = /^[a-zA-Z0-9._%+-]+@@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
                // Biểu thức chính quy cho số điện thoại Việt Nam (10 chữ số, đầu số hợp lệ)
                const phonePattern = /^(0)(32|33|34|35|36|37|38|39|70|71|72|73|74|75|76|77|78|79|81|82|83|84|85|86|87|88|89|90|91|92|93|94|95|96|97|98|99)[0-9]{7}$/;
                // Kiểm tra độ dài của tên đăng nhập
                if (taikhoanDK && taikhoanDK.value.trim().length < 6) {
                    event.preventDefault();
                    event.stopPropagation();
                    isValid = false;

                    // Hiển thị lỗi cho trường tên đăng nhập
                    taikhoanDK.classList.add('is-invalid');
                    taikhoanDK.nextElementSibling.textContent = "Tài khoản phải có ít nhất 6 ký tự.";
                } else {
                    taikhoanDK.classList.remove('is-invalid');
                }
                // Kiểm tra độ dài của tên
                if (nameFull && nameFull.value.trim().length < 10) {
                    event.preventDefault();
                    event.stopPropagation();
                    isValid = false;

                    // Hiển thị lỗi cho tên
                    nameFull.classList.add('is-invalid');
                    nameFull.nextElementSibling.textContent = "Họ và tên phải có ít nhất 10 ký tự.";
                } else {
                    nameFull.classList.remove('is-invalid');
                }
                // Kiểm tra độ dài của số điện thoại
                if (registerPhone && !phonePattern.test(registerPhone.value.trim())) {
                    event.preventDefault();
                    event.stopPropagation();
                    isValid = false;

                    // Hiển thị lỗi cho trường số điện thoại
                    registerPhone.classList.add('is-invalid');
                    registerPhone.nextElementSibling.textContent = "Số điện thoại không hợp lệ";
                } else {
                    registerPhone.classList.remove('is-invalid');
                }
                // Kiểm tra định dạng của email
                if (emailDK && !emailPattern.test(emailDK.value.trim())) {
                    event.preventDefault();
                    event.stopPropagation();
                    isValid = false;

                    // Hiển thị lỗi cho email
                    emailDK.classList.add('is-invalid');
                    emailDK.nextElementSibling.textContent = "Email không đúng định dạng.";
                } else {
                    emailDK.classList.remove('is-invalid');
                }

                // Kiểm tra ngày sinh
                // Lấy ngày hiện tại
                const today = new Date();

                // Chuyển giá trị ngày sinh thành đối tượng Date
                const dobInput = new Date(dob.value);
                const minAge = 18;
                const minDate = new Date(today.getFullYear() - minAge, today.getMonth(), today.getDate());
                
                if (dobInput > minDate) {
                    event.preventDefault();
                    event.stopPropagation();
                    isValid = false;

                    // Hiển thị lỗi cho ngày sinh
                    dob.classList.add('is-invalid');
                    dob.nextElementSibling.textContent = "Bạn phải ít nhất 18 tuổi.";
                } else {
                    dob.classList.remove('is-invalid');
                }

                // Kiểm tra độ dài của mật khẩu
                if (password && password.value.trim().length < 6) {
                    event.preventDefault();
                    event.stopPropagation();
                    isValid = false;

                    // Hiển thị lỗi cho trường mật khẩu
                    password.classList.add('is-invalid');
                    password.nextElementSibling.textContent = "Mật khẩu phải có ít nhất 6 ký tự.";
                } else {
                    password.classList.remove('is-invalid');
                }

                // Kiểm tra độ dài của mật khẩu xác nhận
                if (confirmPassword && confirmPassword.value.trim().length < 6) {
                    event.preventDefault();
                    event.stopPropagation();
                    isValid = false;

                    // Hiển thị lỗi cho trường mật khẩu xác nhận
                    confirmPassword.classList.add('is-invalid');
                    confirmPassword.nextElementSibling.textContent = "Mật khẩu phải có ít nhất 6 ký tự.";
                } else {
                    confirmPassword.classList.remove('is-invalid');
                }

                // Kiểm tra mật khẩu và mật khẩu xác nhận có khớp không
                if (isValid && password && confirmPassword && password.value.trim() !== confirmPassword.value.trim()) {
                    event.preventDefault();
                    event.stopPropagation();
                    isValid = false;

                    // Hiển thị lỗi cho trường mật khẩu xác nhận
                    confirmPassword.classList.add('is-invalid');
                    confirmPassword.nextElementSibling.textContent = "Mật khẩu xác nhận không khớp.";
                } else if (isValid) {
                    confirmPassword.classList.remove('is-invalid');
                }

                registerForm.classList.add('was-validated');
        });

            const forms = document.querySelector('#loginForm');
            forms.addEventListener('submit', event => {
            // Lấy các trường mật khẩu
            const password = document.getElementById('loginPasswordDN');
            let isValid = true;


            // Kiểm tra độ dài của mật khẩu
            if (password.value.trim().length < 6) {
                event.preventDefault();
                event.stopPropagation();
                isValid = false;
                let invalid = password.parentElement.getElementsByClassName('invalid-feedback');

                password.classList.add('is-invalid');
                invalid[0].classList.add('is-invalid');
                // invalid[0;
                // Hiển thị lỗi cho trường mật khẩu
                invalid[0].style.display = 'block';
                invalid[0].innerHTML = "Mật khẩu phải có ít nhất 6 ký tự.";
            } else {
                let invalid = password.parentElement.getElementsByClassName('invalid-feedback');
                password.classList.remove('is-invalid');
                invalid[0].classList.remove('is-invalid');
                invalid[0].style.display = 'none';
            }


            forms.classList.add('was-validated');
        });
    })();
    let state = "@ViewData["State"]".replaceAll("&quot;","");
    let isError = "@ViewData["IsError"]".replace("True", true).replace("False",false);
    const toastContainer = document.getElementById('toast-container');
    // Hiển thị thông báo
    function showToast(message, isError = false) {
        const toast = document.createElement('div');
        if (isError == 'false') {
            toast.className = `toast align-items-center text-bg-success border-0 show`;

        } else if (isError == 'true') {
            toast.className = `toast align-items-center text-bg-danger border-0 show`;
        }
        toast.setAttribute('role', 'alert');
        toast.innerHTML = `
                        <div class="d-flex">
                            <div class="toast-body">${message}</div>
                            <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                        </div>
                        `;

        toastContainer.appendChild(toast);

        setTimeout(() => {
            toast.remove();
        }, 3000);
    }
    if (state != null && state != ""){
        showToast(state, isError);
    }
</script>